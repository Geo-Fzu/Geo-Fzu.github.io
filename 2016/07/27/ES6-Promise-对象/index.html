<!DOCTYPE html>
<html lang=en>
<head><meta name="generator" content="Hexo 3.8.0">
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="Promise 是异步编程的一种解决方案，比传统的回调函数更合理和强大。Promise 保存未来才会结束的事件（通常是一个异步操作）的结果，从 Promise 中可以获得异步操作的消息。">
<meta name="keywords" content="ES6,JavaScript,异步">
<meta property="og:type" content="article">
<meta property="og:title" content="ES6 Promise 对象">
<meta property="og:url" content="http://upon.ink/2016/07/27/ES6-Promise-对象/index.html">
<meta property="og:site_name" content="upon.ink">
<meta property="og:description" content="Promise 是异步编程的一种解决方案，比传统的回调函数更合理和强大。Promise 保存未来才会结束的事件（通常是一个异步操作）的结果，从 Promise 中可以获得异步操作的消息。">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2019-01-07T17:29:30.307Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ES6 Promise 对象">
<meta name="twitter:description" content="Promise 是异步编程的一种解决方案，比传统的回调函数更合理和强大。Promise 保存未来才会结束的事件（通常是一个异步操作）的结果，从 Promise 中可以获得异步操作的消息。">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.png">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.png">
          
        
    
    <!-- title -->
    <title>ES6 Promise 对象</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- persian styles -->
    
      <link rel="stylesheet" href="/css/rtl.css">
    
    <!-- rss -->
    
    
</head>

<body class="max-width mx-auto px3 ltr">    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/categories/">Category</a></li>
         
          <li><a href="/tags/">Tag</a></li>
        
      </ul>
    </span>
    <br>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2016/07/30/2016年7月29日-阳台/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2016/07/24/Html5-article-与-section-标签/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://upon.ink/2016/07/27/ES6-Promise-对象/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://upon.ink/2016/07/27/ES6-Promise-对象/&text=ES6 Promise 对象"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://upon.ink/2016/07/27/ES6-Promise-对象/&title=ES6 Promise 对象"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://upon.ink/2016/07/27/ES6-Promise-对象/&is_video=false&description=ES6 Promise 对象"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=ES6 Promise 对象&body=Check out this article: http://upon.ink/2016/07/27/ES6-Promise-对象/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://upon.ink/2016/07/27/ES6-Promise-对象/&title=ES6 Promise 对象"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://upon.ink/2016/07/27/ES6-Promise-对象/&title=ES6 Promise 对象"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://upon.ink/2016/07/27/ES6-Promise-对象/&title=ES6 Promise 对象"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://upon.ink/2016/07/27/ES6-Promise-对象/&title=ES6 Promise 对象"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://upon.ink/2016/07/27/ES6-Promise-对象/&name=ES6 Promise 对象&description=&lt;p&gt;&lt;code&gt;Promise&lt;/code&gt; 是异步编程的一种解决方案，比传统的回调函数更合理和强大。Promise 保存未来才会结束的事件（通常是一个异步操作）的结果，从 Promise 中可以获得异步操作的消息。&lt;/p&gt;"><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-Promise-的三种状态"><span class="toc-number">1.</span> <span class="toc-text">1. Promise 的三种状态</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-Promise-的基本用法"><span class="toc-number">2.</span> <span class="toc-text">2. Promise 的基本用法</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-Promise-的构造和使用"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 Promise 的构造和使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-Promise-的示例"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 Promise 的示例</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-Promise-的方法"><span class="toc-number">3.</span> <span class="toc-text">3. Promise 的方法</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-Promise-prototype-then"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 Promise.prototype.then()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-Promise-prototype-catch"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 Promise.prototype.catch()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-Promise-all"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 Promise.all()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-Promise-race"><span class="toc-number">3.4.</span> <span class="toc-text">3.4 Promise.race()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-5-Promise-resolve"><span class="toc-number">3.5.</span> <span class="toc-text">3.5 Promise.resolve()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-6-Promise-reject"><span class="toc-number">3.6.</span> <span class="toc-text">3.6 Promise.reject()</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope="" itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        ES6 Promise 对象
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
        <span itemprop="name">upon.ink</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2016-07-27T22:26:55.000Z" itemprop="datePublished">2016-07-27</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/tech/">tech</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/ES6/">ES6</a>, <a class="tag-link" href="/tags/JavaScript/">JavaScript</a>, <a class="tag-link" href="/tags/异步/">异步</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p><code>Promise</code> 是异步编程的一种解决方案，比传统的回调函数更合理和强大。Promise 保存未来才会结束的事件（通常是一个异步操作）的结果，从 Promise 中可以获得异步操作的消息。</p>
<a id="more"></a>
<h1 id="1-Promise-的三种状态"><a href="#1-Promise-的三种状态" class="headerlink" title="1. Promise 的三种状态"></a>1. Promise 的三种状态</h1><ul>
<li>Promise 对象代表一个异步操作，有三种状态：<br>_ <code>Pending</code> （进行中）<br>_ <code>Resolved</code> （已完成， Fulfilled） * <code>Rejected</code> （已失败）<br>只有异步操作的结果可以决定当前是哪一种状态，任何其他操作不能改变这个状态。</li>
<li>Promise 只有两种状态改变的可能：<br>_ 从 Pending 变为 Resolved<br>_ 从 Pending 变为 Rejected<br><strong>一旦状态改变，就不会再改变。</strong></li>
</ul>
<p>有了 Promise 对象，可以将异步操作以同步操作的流程表达出来，避免了层层嵌套的回调函数（callback hell）。</p>
<p>Promise 一旦新建就会立即执行，无法中途取消。如果不设置回调函数，Promise 内部抛出的错误不会反应到外部。</p>
<h1 id="2-Promise-的基本用法"><a href="#2-Promise-的基本用法" class="headerlink" title="2. Promise 的基本用法"></a>2. Promise 的基本用法</h1><h2 id="2-1-Promise-的构造和使用"><a href="#2-1-Promise-的构造和使用" class="headerlink" title="2.1 Promise 的构造和使用"></a>2.1 Promise 的构造和使用</h2><ul>
<li>Promise 的构造<br>Promise 是一个构造函数，用来生成 Promise 实例。下面代码构造了一个 Promise 实例：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Promise 构造函数接收一个函数作为参数，该函数的两个参数分别是 resolve 和 reject，这是两个函数。</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ... 异步操作代码</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="comment">/*异步操作成功*/</span>)&#123;</span><br><span class="line">        resolve(value);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        reject(error);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<pre><code>* `resovle` 将 Promise 对象状态从 Pending 变为 Resolved，在异步操作成功时调用。并且将异步操作的结果，作为参数传递出去。
* `reject` 将 Promise 对象状态从 Pending 变为 Rejected，在异步操作失败时调用。将异步操作报出的错误，作为参数传递出去。
</code></pre><ul>
<li>Promise 的使用<br>Promise 实例生成之后，可以用 <code>then</code> 方法分别指定 Resolved 和 Rejected 状态的回调函数：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">promise.then(<span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// promise 中的异步操作成功时执行，即 Promise 状态变为 Resolved，value 为 resolve 返回的值</span></span><br><span class="line">    &#125;，<span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 异步操作失败时执行的回调函数，即 Promise 状态变为 Rejected。</span></span><br><span class="line">    <span class="comment">// 这个函数是可选的。</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="2-2-Promise-的示例"><a href="#2-2-Promise-的示例" class="headerlink" title="2.2 Promise 的示例"></a>2.2 Promise 的示例</h2><ul>
<li>简单例子：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">timeout</span>(<span class="params">ms</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    setTimeout(resolve, ms, <span class="string">"done"</span>);</span><br><span class="line">    <span class="comment">// setTimeout(callback, delay[, ...arg])</span></span><br><span class="line">    <span class="comment">// [, ...arg] Optional arguments to pass when the callback is called.</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">timeout(<span class="number">100</span>).then(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(value);</span><br><span class="line">  <span class="comment">// 'done'</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li>Promise 创建后立刻执行：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"Promise"</span>);</span><br><span class="line">  resolve();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">promise.then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"then"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"Hi!"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Promise</span></span><br><span class="line"><span class="comment">// Hi!</span></span><br><span class="line"><span class="comment">// then</span></span><br></pre></td></tr></table></figure>
<p>上面代码中，Promise 新建后立即执行，所以首先输出 “Promise”。<code>then</code> 方法指定的回调函数，将在当前脚本所有同步任务完成后才会执行，所以最后输出 “then”。</p>
<ul>
<li>resolve 函数传递另一个 Promise 实例<br>如果在调用 resolve 和 reject 函数时带有参数，那么它们的参数会被传递给回调函数。<br><code>reject</code> 通常接收 Error 对象的实例作为参数，表示抛出的错误；<code>resolve</code> 函数的参数可以是正常的值，还可能是另一个 Promise 对象实例。<br>这表示异步操作的结果可能是一个值，也可能是另一个异步操作：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> p1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  resolve(p1);</span><br><span class="line">  <span class="comment">// p2 的 resolve 方法将 p1 作为参数，即一个异步操作的结果是返回另一个异步操作。</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>这时， p1 的状态就会传递给 p2，也就是说，p1 决定了 p2 的状态。<br>如果 p1 状态是 Pending，那么 p2 的回调函数就会等待 p1 的状态改变；如果 p1 的状态已经是 Resolved 或者 Rejected，那么 p2 的回调函数将会立即执行:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> p1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"promise in p1"</span>);</span><br><span class="line">    reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"fail"</span>));</span><br><span class="line">  &#125;, <span class="number">3000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"promise in p2"</span>);</span><br><span class="line">    resolve(p1);</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">p2.then(<span class="function"><span class="params">result</span> =&gt;</span> <span class="built_in">console</span>.log(result)).catch(<span class="function"><span class="params">error</span> =&gt;</span> <span class="built_in">console</span>.log(error));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出结果：</span></span><br><span class="line"><span class="comment">// promise in p2</span></span><br><span class="line"><span class="comment">// promise in p1</span></span><br><span class="line"><span class="comment">// [Error: fail]</span></span><br></pre></td></tr></table></figure>
<h1 id="3-Promise-的方法"><a href="#3-Promise-的方法" class="headerlink" title="3. Promise 的方法"></a>3. Promise 的方法</h1><h2 id="3-1-Promise-prototype-then"><a href="#3-1-Promise-prototype-then" class="headerlink" title="3.1 Promise.prototype.then()"></a>3.1 Promise.prototype.then()</h2><p>Promise 实例具有 then 方法，定义在 Promise.prototype 上。它的作用是为 Promise 实例添加状态改变时的回调函数。<br>then 方法的第一个参数是 <code>Resolved</code> 状态的回调函数，第二个参数（可选）是 <code>Rejected</code> 状态的回调函数。<br><strong>then 方法返回的是一个新的 Promise 实例（注意，不是原来那个 Promise 实例）。因此可以采用链式写法，即 then 方法后面再调用另一个 then 方法。</strong><br>采用链式的 then，可以指定一组按照次序调用的回调函数。这时，前一个回调函数，有可能返回的还是一个 Promise 对象（即有异步操作），这时后一个回调函数，就会等待该 Promise 对象的状态发生变化，才会被调用：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  setTimeout(resolve, <span class="number">1000</span>, <span class="string">"promise chain"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果 then 返回的不是 Promise 对象</span></span><br><span class="line">promise</span><br><span class="line">  .then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"1"</span>, data);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">    <span class="keyword">return</span> data;</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"2"</span>, data);</span><br><span class="line">  &#125;);</span><br><span class="line"><span class="comment">// 由于第一个 then 函数里执行的是异步操作，所以先执行第二个 then，执行结果为：</span></span><br><span class="line"><span class="comment">// 2 promise chain</span></span><br><span class="line"><span class="comment">// 1 promise chain</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果返回的是一个 Promise 对象：</span></span><br><span class="line">promise</span><br><span class="line">  .then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">      setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"1"</span>, data);</span><br><span class="line">        resolve(data);</span><br><span class="line">      &#125;, <span class="number">1000</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"2"</span>, data);</span><br><span class="line">  &#125;);</span><br><span class="line"><span class="comment">// 返回的是一个 Promise 对象，所以第二个 then 函数会等第一个 then 函数中的异步操作执行完成后，再根据其状态执行回调函数，执行结果为：</span></span><br><span class="line"><span class="comment">// 1 promise chain</span></span><br><span class="line"><span class="comment">// 2 promise chain</span></span><br></pre></td></tr></table></figure>
<h2 id="3-2-Promise-prototype-catch"><a href="#3-2-Promise-prototype-catch" class="headerlink" title="3.2 Promise.prototype.catch()"></a>3.2 Promise.prototype.catch()</h2><p>Promise.protype.catch 与 .then(null, rejectFun) 是相同的作用，用于指定发生错误时的回调函数。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">promise</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 处理 promise 和前一个回调函数运行时发生的错误</span></span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<p>下面是一个例子：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> p1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"promise in p1"</span>);</span><br><span class="line">    reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"fail"</span>));</span><br><span class="line">  &#125;, <span class="number">3000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"promise in p2"</span>);</span><br><span class="line">    resolve(p1);</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">p2.then(<span class="function"><span class="params">result</span> =&gt;</span> <span class="built_in">console</span>.log(result)).catch(<span class="function"><span class="params">error</span> =&gt;</span> <span class="built_in">console</span>.log(error));</span><br><span class="line"></span><br><span class="line"><span class="comment">// promise in p2</span></span><br><span class="line"><span class="comment">// promise in p1</span></span><br><span class="line"><span class="comment">// [Error: fail]</span></span><br></pre></td></tr></table></figure>
<p><strong>注：</strong>如果 Promise 状态已经变成 Resolved 那么再抛出错误是无效的。<br>Promise 对象的错误具有<em>冒泡</em>性质，会一直向后传递，直到被捕获为止。也就是说，错误总是会被下一个 catch 语句捕获。<br><strong>catch 方法返回的还是一个 Promise 对象，因此后面还可以接着调用 then 方法。</strong></p>
<h2 id="3-3-Promise-all"><a href="#3-3-Promise-all" class="headerlink" title="3.3 Promise.all()"></a>3.3 Promise.all()</h2><p>Promise.all 方法用于将多个 Promise 实例，包装成一个新的 Promise 实例。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> p = <span class="built_in">Promise</span>.all([p1, p2, p3]);</span><br></pre></td></tr></table></figure>
<ul>
<li>p 的状态由 p1、 p2、 p3 决定，分成两种情况。<ul>
<li>只有 p1、 p2、 p3 的状态都变成 Resovled， p 的状态才会变成 Resovled，此时 p1、 p2、 p3 的返回值组成一个数组，传递给 p 的回调函数。</li>
<li>只要 p1、 p2、 p3 之中有一个被 Rejected，p 的状态就变成 Rejected，此时第一个被 reject 的实例的返回值，会传递给 p 的回调函数。</li>
</ul>
</li>
</ul>
<h2 id="3-4-Promise-race"><a href="#3-4-Promise-race" class="headerlink" title="3.4 Promise.race()"></a>3.4 Promise.race()</h2><p>Promise.race 方法同样是将多个 Promise 实例，包装成一个新的 Promise 实例。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> p = <span class="built_in">Promise</span>.race([p1, p2, p3]);</span><br></pre></td></tr></table></figure>
<p>只要 p1、 p2、 p3 之中有一个实例率先改变状态， p 的状态就跟着改变。那个率先改变的 Promise 实例的返回值，就传递给 p 的回调函数。</p>
<h2 id="3-5-Promise-resolve"><a href="#3-5-Promise-resolve" class="headerlink" title="3.5 Promise.resolve()"></a>3.5 Promise.resolve()</h2><p>有时需要将现有对象转为 Promise 对象，Promise.resolve 方法就起到这个作用。</p>
<ul>
<li>如果参数是 Promise 实例，那么 Promise.resolve 将不做任何修改、原封不动返回这个实例。</li>
<li>如果参数是 <code>thenable</code> 对象，例如：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> thenable = &#123;</span><br><span class="line">  then: <span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    resolve(<span class="string">"thenable"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Promise.resovle 方法会将这个对象转为 Promise 对象，然后就立即执行 thenable 对象的 then 方法。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> promise = <span class="built_in">Promise</span>.resolve(thenable);</span><br><span class="line">promise.then(<span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(value);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>上面代码中，thenable 对象的 then 方法执行后，对象 promise 的状态就变为 Resolved，从而立即执行最后那个 then 方法指定的回调函数，输出 ‘thenable’。</p>
<ul>
<li>如果参数是一个原始值，或者是一个不具有 then 方法的对象，则 Promise.resolve 方法返回一个新的 Promise 对象，状态为 Resolved。</li>
<li>Promise.resolve 方法允许调用时不带参数，直接返回一个 Resolved 状态的 Promise 对象。</li>
</ul>
<h2 id="3-6-Promise-reject"><a href="#3-6-Promise-reject" class="headerlink" title="3.6 Promise.reject()"></a>3.6 Promise.reject()</h2><p>Promise.reject(reason) 方法也会返回一个新的 Promise 实例，该实例的状态为 Rejected。它的参数用法与 Promise.resolve 方法完全一致。</p>
<blockquote>
<p><a href="http://es6.ruanyifeng.com/#docs/promise" title="ECMAScript 6 入门" target="_blank" rel="noopener">参考链接</a></p>
</blockquote>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/categories/">Category</a></li>
         
          <li><a href="/tags/">Tag</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-Promise-的三种状态"><span class="toc-number">1.</span> <span class="toc-text">1. Promise 的三种状态</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-Promise-的基本用法"><span class="toc-number">2.</span> <span class="toc-text">2. Promise 的基本用法</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-Promise-的构造和使用"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 Promise 的构造和使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-Promise-的示例"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 Promise 的示例</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-Promise-的方法"><span class="toc-number">3.</span> <span class="toc-text">3. Promise 的方法</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-Promise-prototype-then"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 Promise.prototype.then()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-Promise-prototype-catch"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 Promise.prototype.catch()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-Promise-all"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 Promise.all()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-Promise-race"><span class="toc-number">3.4.</span> <span class="toc-text">3.4 Promise.race()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-5-Promise-resolve"><span class="toc-number">3.5.</span> <span class="toc-text">3.5 Promise.resolve()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-6-Promise-reject"><span class="toc-number">3.6.</span> <span class="toc-text">3.6 Promise.reject()</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://upon.ink/2016/07/27/ES6-Promise-对象/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://upon.ink/2016/07/27/ES6-Promise-对象/&text=ES6 Promise 对象"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://upon.ink/2016/07/27/ES6-Promise-对象/&title=ES6 Promise 对象"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://upon.ink/2016/07/27/ES6-Promise-对象/&is_video=false&description=ES6 Promise 对象"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=ES6 Promise 对象&body=Check out this article: http://upon.ink/2016/07/27/ES6-Promise-对象/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://upon.ink/2016/07/27/ES6-Promise-对象/&title=ES6 Promise 对象"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://upon.ink/2016/07/27/ES6-Promise-对象/&title=ES6 Promise 对象"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://upon.ink/2016/07/27/ES6-Promise-对象/&title=ES6 Promise 对象"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://upon.ink/2016/07/27/ES6-Promise-对象/&title=ES6 Promise 对象"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://upon.ink/2016/07/27/ES6-Promise-对象/&name=ES6 Promise 对象&description=&lt;p&gt;&lt;code&gt;Promise&lt;/code&gt; 是异步编程的一种解决方案，比传统的回调函数更合理和强大。Promise 保存未来才会结束的事件（通常是一个异步操作）的结果，从 Promise 中可以获得异步操作的消息。&lt;/p&gt;"><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2019 upon
    <a href="http://www.miitbeian.gov.cn" rel="nofollow">浙ICP备18057077号</a>
    <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33011002013730">浙公网安备 33011002013730号</a>
  </div>
</footer>

    </div>
</body>
</html>
<!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">

<!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>
<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Disqus Comments -->


